# Spring Batch

批处理：批处理是指在处理SQL语句的时候一次执行多条操作而不是像普通的jdbc一条条的操作，这种批处理可以极大提升执行SQL语句的效率。

> 不使用批处理INSERT 1000000数据时间在20 min左右，
>
> 使用批处理INSERT 1000000数据时间在6s左右。

[Spring Batch介绍 | Spring Batch参考文档中文版 (gitbooks.io)](https://kimmking.gitbooks.io/springbatchreference/content/01_introduction/index.html)

## 使用场景

### 业务场景

- **定期提交批处理任务**
- **并发批处理：并行执行任务**
- 分阶段，企业消息驱动处理
- **高并发批处理任务**
- **失败后手动或定时重启**
- 按顺序处理任务依赖(使用工作流驱动的批处理插件)
- 局部处理：跳过记录(例如在回滚时)
- 完整的批处理事务：因为可能有小数据量的批处理或存在存储过程/脚本



### 技术场景

- 利用Spring编程模式：使开发者专注于业务逻辑，让框架解决基础功能
- 在基础架构、批处理执行环境、批处理应用之间有明确的划分
- 以接口形式提供通用的核心服务，以便所有项目都能使用
- 提供简单的默认实现，以实现核心执行接口的“开箱即用”
- 易于配置、定制和扩展服务,基于spring框架的各个层面
- 所有的核心服务都可以很容易地扩展与替换，却不会影响基础系统层。
- 提供一个简单的部署模型，通过Maven编译,将应用程序与框架的JAR包完全分离



## 通用的批处理指导原则

- 批处理架构通常会影响在线的服务架构，反之亦然。设计架构和环境的时候尽可能使用公共的模块。
- 尽可能简化，避免在单个批处理应用中构建复杂的逻辑结构
- 尽可能在数据存放的地方负责处理这些数据，反之亦然（各自处理各自的数据）
- 尽可能少地使用系统资源，尤其是I/O，尽可能多地在内存中执行大部分操作
- 避免不必要的物理I/O，尤其是以下四种：
  1. 避免读取所有数据（即使有些数据并不需要），并且缓存
  2. 避免多次读取/查询同一事务中已经读取过的数据
  3. 避免引起不必要的表或者索引的扫描
  4. 避免在where子句中不指定条件
- 在同一个批处理中避免做同样的事情，例如遍历了一遍表中的数据，下一次请使用增量存储，尽可能不要再遍历一遍同样的数据
- 在批处理开始之前就分配足够的内存
- 对于数据的完整性做最坏的打算，插入适当的完整性校验以保持数据完整性，如果有可能，在程序内部使用校验和(checksum)。
- 尽早使用模拟真实生产的数据
- 文件备份程序定期测试



## Job





















