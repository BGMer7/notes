# Log Standard

## 日志记录的作用

一般程序日志出自下面几个方面的需求：

1. 记录用户操作的审计日志，甚至有的时候就是监管部门的要求。
2. 快速定位问题的根源
3. 追踪程序执行的过程。
4. 追踪数据的变化
5. 数据统计和性能分析
6. 采集运行环境数据

一般在程序上线之后，一旦发生异常，第一件事就是要弄清楚当时发生了什么。用户当时做了什么操作，环境有无影响，数据有什么变化，是不是反复发生等，然后再进一步的确定大致是哪个方面的问题。确定是程序的问题之后再交由开发人员去重现、研究、提出解决方案。这时，日志就给我们提供了第一手的资料。



## 日志记录的要求

### 日志的可读性

日志时给人读的，不仅仅是让自己明白，也要让没有接触过我们源代码的其他程序员也能够一目了然。有的同事在日志中打印特殊的标识符号，例如“`++++++++++`”， “`===========`”，“`—————`”，这些符号令人眼花缭乱。这是一种不好的编程习惯。

另外，**把日志分类输出到不同的文件也有利于我们排除干扰**，迅速找到我们需要的信息。而且，最好在打印日志时输出英文，防止中文不支持而打印出乱码的情况。

### 日志的性能

无论我们把日志写到文件还是数据库，都需要消耗IO资源。适当的控制日志的输出也有利于提高程序的性能。

例如：**尽量避免在在大的循环中打印意义不大的日志内容。**输出日志之前最好能判断日志的级别(例如. debug前先调用`isDebugEnabled()`作出判断)。

### 日志的级别

通常我们在产品环境中日志的级别都在INFO以上，所以我们必须保证在这样的情况下程序仍然能够输出足够我们作出判断的信息。

### 日志的内容





## 日志级别

遵循 [RFC 5424](https://link.zhihu.com/?target=https%3A//tools.ietf.org/html/rfc5424)，将日志级别分为以下 8 种等级：

- 0 Emergency: system is unusable
- 1 Alert: action must be taken immediately
- 2 Critical: critical conditions
- 3 Error: error conditions
- 4 Warning: warning conditions
- 5 Notice: normal but significant condition
- 6 Informational: informational messages
- 7 Debug: debug-level messages

各级日志等级信息记录内容如下：

### Emergency

- 导致系统不可用的事故，属于最严重的日志级别，因此该日志级别必须慎用
- 通常情况下，**一个进程的声明周期中应该只记录一次 Emergency 级别的日志**

### Alert

- 必须马上处理的问题，紧急程度低于 Emergency
- Alert 错误发生时，已经影响了用户的正常访问
- 与 Emergency 的区别是，Alert 状态下系统依旧是可用的。例如：DB / Cache 无法连接。

### Critical

紧急情况，程序组件不可用，需要立刻进行修复。例如：用户注册逻辑模块不能发送邮件。

### Error

- 运行时出现的错误，不必要立即进行修复
- 错误不影响整个逻辑的运行，但需要记录并做检测。

### Warning

- 可能影响系统功能，需要提醒的重要事件
- 该日志标示系统可能出现问题，也可能没有（比如网络波动）。对于那些目前还不是错误，然而不及时处理也会变为错误的情况，也可以记为 Warning 日志。例如一个存储系统的磁盘使用量超过阀值，或者系统中某个用户的存储配额快用完等等
- 对于 Warining 级别的日志，虽然不需要马上处理，但也需要及时查看并处理

### Notice

- 不影响正常功能，但需要注意的消息
- 执行过程中较 Infomational 级别更为重要的信息。

### Infomational

- 用于记录系统正常运行情况下的一般信息，强调应用程序的运行过程。例如：某个子模块的初始化、某个请求的成功执行等
- 通过查看 Infomational 级别的日志，可以很快对系统中出现的 0~5 级别的错误进行定位

### Debug

帮助开发、测试、运维人员对系统进行诊断的信息。